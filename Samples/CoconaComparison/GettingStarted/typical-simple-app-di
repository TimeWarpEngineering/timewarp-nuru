#!/usr/bin/dotnet --
// typical-simple-app-di - Nuru DI/class-based version of Cocona's GettingStarted.TypicalSimpleApp
#:project ../../../Source/TimeWarp.Nuru/TimeWarp.Nuru.csproj
#:package Mediator.Abstractions
#:package Mediator.SourceGenerator

using TimeWarp.Nuru;
using Mediator;
using Microsoft.Extensions.DependencyInjection;
using static System.Console;

// Typical simple CLI app with DI support
NuruApp app = new NuruAppBuilder()
    .AddDependencyInjection()
    .ConfigureServices(services => services.AddMediator())
    .Map<HelloCommand>("hello {name|Your name} --to-upper-case,-u|Print a name converted to upper-case {toUpperCase:bool}")
    .AddAutoHelp()
    .Build();

return await app.RunAsync(args);

// Command class following typical enterprise patterns
public sealed class HelloCommand : IRequest
{
    public string Name { get; set; } = string.Empty;
    public bool ToUpperCase { get; set; }

    internal sealed class Handler : IRequestHandler<HelloCommand>
    {
        public ValueTask<Unit> Handle(HelloCommand request, CancellationToken cancellationToken)
        {
            WriteLine($"Hello {(request.ToUpperCase ? request.Name.ToUpper() : request.Name)}!");
            return default;
        }
    }
}
