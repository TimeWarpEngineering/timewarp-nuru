# Address sample compilation warnings

## Description

Many samples produce compilation warnings that should be investigated and resolved. These may indicate configuration issues or areas needing attention.

## Checklist

- [x] Add source generator emit to samples/Directory.Build.props for debugging
- [ ] Investigate `MSG0005: MediatorGenerator found message without any registered handler: Default_Generated_Query` - appears in ~25 samples
- [x] Investigate `CS0436` type conflict warnings in aot-example (Default_Generated_Query defined in both generated code and library) - **FIXED**: Updated `GenerateClassName` to extract option names from option-only patterns like `--capabilities`
- [x] Investigate `CS8785: Generator 'NuruRouteAnalyzer' failed to generate source` - FileNotFoundException for Microsoft.Extensions.Logging.Abstractions - **FIXED**: Added `#if !ANALYZER_BUILD` conditional compilation to exclude logging dependencies when compiled as analyzer

## Notes

### Fixes Applied

**Fix 1: CS0436 Type Conflict (Default_Generated_Query)**
- Modified `GenerateClassName` in `nuru-delegate-command-generator.route-parsing.cs`
- Now extracts option names from patterns like `--capabilities` → `Capabilities_Generated_Query`
- This prevents the library's `--capabilities` route from conflicting with sample's `{*args}` route

**Fix 2: CS8785 NuruRouteAnalyzer Assembly Loading**
- The parsing code uses `ILogger<T>` from `Microsoft.Extensions.Logging.Abstractions`
- When compiled into the analyzer, this dependency couldn't be loaded at compile time
- Added `#if !ANALYZER_BUILD` conditionals around logging code in:
  - `GlobalUsings.cs` - wrapped logging imports
  - `logger-message-definitions.cs` - wrapped entire file
  - `lexer.cs` - wrapped logger field and logging calls
  - `compiler.cs` - wrapped logger field and logging calls
  - `parser.cs` - wrapped logger field and logging calls
  - `pattern-parser.cs` - wrapped overload with ILoggerFactory

**Fix 3: CS0103 WriteLine not found (Task 233)**
- Modified `ParameterRewriter` to accept `SemanticModel`
- Rewrites identifiers from static usings to fully-qualified names
- `WriteLine` → `global::System.Console.WriteLine`

### Root Cause Analysis (completed)

The `Default_Generated_Query` without a handler is generated by the `timewarp-nuru` library itself due to two bugs in `NuruDelegateCommandGenerator`:

**Bug 1: Pattern naming issue** - FIXED
- The `--capabilities` route pattern starts with `-`
- `GenerateClassName` now extracts option names from option-only patterns

**Bug 2: Class generated without handler** - Still outstanding (MSG0005)
- The handler `DisplayCapabilitiesAsync` is a **method group**, not a lambda
- `ExtractHandlerInfo` in `nuru-delegate-command-generator.handler.cs:19` returns `null` for non-lambda handlers
- But `ExtractCommandInfo` still creates `DelegateCommandInfo` with `Handler: null`
- Codegen emits the class WITHOUT a nested Handler class
- Mediator sees `IQuery<Unit>` with no `IQueryHandler` → MSG0005

### Remaining Work

- [ ] Fix MSG0005 warnings - don't emit classes without handlers when `handlerInfo is null`

### Files Modified

- `source/timewarp-nuru-analyzers/analyzers/nuru-delegate-command-generator.route-parsing.cs`
- `source/timewarp-nuru-analyzers/analyzers/nuru-delegate-command-generator.rewriter.cs`
- `source/timewarp-nuru-analyzers/analyzers/nuru-delegate-command-generator.handler.cs`
- `source/timewarp-nuru-parsing/GlobalUsings.cs`
- `source/timewarp-nuru-parsing/logging/logger-message-definitions.cs`
- `source/timewarp-nuru-parsing/parsing/lexer/lexer.cs`
- `source/timewarp-nuru-parsing/parsing/compiler/compiler.cs`
- `source/timewarp-nuru-parsing/parsing/parser/parser.cs`
- `source/timewarp-nuru-parsing/parsing/pattern-parser.cs`
